import B from"./button.esm.5ff57d1b.js";import E from"./skeleton.esm.0b70d447.js";import N from"./tag.esm.fad75f30.js";import U from"./inputtext.esm.d2a0a15b.js";import A from"./inputnumber.esm.e03d5b06.js";import z from"./textarea.esm.b1b8aa12.js";import F from"./inputswitch.esm.7b6db165.js";import I from"./dialog.esm.b0efff36.js";import{u as L,r as v,o as a,n as S,w as k,b as i,a as e,q as t,c,F as w,z as C,d as T,C as H,g as O,t as j,y as q,A as D}from"./entry.d1707d97.js";import M from"./image.esm.5d34968a.js";import G from"./toast.esm.b218d71d.js";import"./badge.esm.237e0a91.js";import"./basecomponent.esm.2b1e363f.js";import"./index.esm.4de9ee35.js";import"./baseicon.esm.017b3b06.js";import"./index.esm.f1c83385.js";import"./index.esm.935c3e0d.js";import"./index.esm.15a50a11.js";import"./portal.esm.e1812259.js";import"./index.esm.6751b36a.js";import"./index.esm.2cb3bde2.js";import"./index.esm.8e3c4dc7.js";import"./index.esm.93ea05ac.js";const J=e("div",{class:"inline-flex align-items-center justify-content-center gap-2"},[e("span",{class:"font-bold white-space-nowrap uppercase"}," Ajout d'un Produit ")],-1),K={class:"flex flex-col text-gray-800"},Q={class:"flex mb-2"},R={class:"flex flex-col mr-3"},W=e("span",{class:""}," Nom du produit ",-1),X={class:"flex flex-col"},Y=e("span",{class:""}," Prix du produit ",-1),Z={class:"flex mb-2"},ee={class:"flex flex-col mr-2"},se=e("span",{class:""}," Description du produit ",-1),te={class:"flex flex-col mr-2"},oe=e("span",{class:""}," Stock du produit ",-1),ie={class:"flex flex-col border mb-2"},le=e("div",{class:"border-b p-2"},[e("span",{class:"text-sm"}," Importer ici les images, la première image choisie sera l'image de couverture du produit ")],-1),ae={class:"flex flex-wrap p-2"},re=["src"],ne=e("label",{for:"file_upload",class:"rounded border-gray-600 cursor-pointer border border-dashed w-[80px] h-[80px] flex justify-center items-center hover:bg-gray-50"},[e("span",{class:"material-icons text-lg"}," add ")],-1),de={class:"flex items-center border p-2"},ce={__name:"addProduct",props:["visible"],emits:["close","validate"],setup(P,{emit:$}){const n=L(),x=P,m=$,s=v({to_publish:!1}),h=v([]),b=async l=>{const o=l.target.files,g=new FormData;g.append("file",o[0]);try{const _=await $fetch("/api/a/uploads/file",{method:"post",body:g});_.status?h.value.push({im_id:_.file_id,im_ref:_.opt.name}):console.log(_.message)}catch(_){console.log(_)}},d=v(!1);async function r(){d.value=!0;try{const l=await $fetch("/api/a/product",{method:"post",body:{pr:s.value,ims:h.value}});l.status?(s.value={},h.value=[],n.add({severity:"success",summary:"Validation de produit",detail:"Produit bien ajouté"}),m("validate")):n.add({severity:"error",summary:"Validation de produit",detail:l.message})}catch(l){console.log(l),n.add({severity:"error",summary:"Tentative de connexion",detail:"Erreur de connexion dans la base"})}d.value=!1}return(l,o)=>{const g=U,_=A,p=z,f=F,y=B,V=I;return a(),S(V,{visible:x.visible,"onUpdate:visible":[o[5]||(o[5]=u=>x.visible=u),o[6]||(o[6]=()=>{m("close")})],modal:"",header:"Header",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{header:k(()=>[J]),footer:k(()=>[i(y,{label:"Valider le produit",icon:"pi pi-check",onClick:r,autofocus:""})]),default:k(()=>[e("div",K,[e("div",Q,[e("div",R,[W,i(g,{modelValue:t(s).prod_label,"onUpdate:modelValue":o[0]||(o[0]=u=>t(s).prod_label=u),placeholder:"Nom du produit",class:"p-inputtext-sm"},null,8,["modelValue"])]),e("div",X,[Y,i(_,{modelValue:t(s).prod_price,"onUpdate:modelValue":o[1]||(o[1]=u=>t(s).prod_price=u),min:0,suffix:" Ar",placeholder:"Prix du produit",class:"p-inputtext-sm"},null,8,["modelValue"])])]),e("div",Z,[e("div",ee,[se,i(p,{modelValue:t(s).prod_desc,"onUpdate:modelValue":o[2]||(o[2]=u=>t(s).prod_desc=u),class:"p-button-sm",placeholder:"Description du produit"},null,8,["modelValue"])]),e("div",te,[oe,i(_,{modelValue:t(s).prod_stock,"onUpdate:modelValue":o[3]||(o[3]=u=>t(s).prod_stock=u),class:"p-button-sm",placeholder:"Stock"},null,8,["modelValue"])])]),e("div",ie,[le,e("div",ae,[e("input",{type:"file",id:"file_upload",class:"hidden",onChange:b},null,32),(a(!0),c(w,null,C(t(h),u=>(a(),c("div",{key:u.im_id,class:"rounded overflow-auto border-gray-600 cursor-pointer mr-2 border w-[80px] h-[80px] flex justify-center items-center hover:bg-gray-50"},[e("img",{src:`/api/p/media/${u.im_ref}`,class:"object-cover",srcset:""},null,8,re)]))),128)),ne])]),e("div",de,[i(f,{class:"p-inputswitch-sm",modelValue:t(s).to_publish,"onUpdate:modelValue":o[4]||(o[4]=u=>t(s).to_publish=u)},null,8,["modelValue"]),T(),e("span",{class:H(["ml-2",{"text-green-500":t(s).to_publish}])}," Publier Directement ",2)])])]),_:1},8,["visible"])}}},pe=e("div",{class:"inline-flex align-items-center justify-content-center gap-2"},[e("span",{class:"font-bold white-space-nowrap uppercase"}," Détails du produits ")],-1),ue={class:"flex flex-col"},_e={class:"border p-2 rounded mb-2"},me=e("span",{class:""}," Les images du produit ",-1),fe={class:"border p-2 rounded"},ve=e("span",{class:""}," Les catégories du produit",-1),he={class:"flex flex-wrap p-1 bg-gray-50 border"},be=["onClick"],xe={class:"capitalize"},ge=e("span",{class:""}," Liste des catégories ",-1),$e={class:"flex flex-wrap p-1 bg-gray-50 border max-h-[200px]"},ye=["onClick"],we={class:"capitalize"},ke={class:"p-1"},Ve={__name:"editProduct",props:["visible","prod_id"],emits:["close","validate"],setup(P,{emit:$}){L();const n=P,x=$;v({to_publish:!1}),v([]);const m=v(!1),s=v({});async function h(){try{const r=await $fetch(`/api/a/cre/product/${n.prod_id}`);r.status&&(s.value=r.prod_info)}catch(r){console.log(r)}}async function b(){m.value=!0;try{(await $fetch("/api/a/cre/product/cat",{method:"put",body:{prod_id:n.prod_id,cat_in:s.value.cat_in}})).status}catch(r){console.log(r)}m.value=!1}async function d(){m.value=!0;try{(await $fetch(`/api/a/product/${n.prod_id}`,{method:"DELETE"})).status&&x("validate")}catch(r){console.log(r)}m.value=!1}return O(()=>n.visible,r=>{r?h():s.value={}}),(r,l)=>{const o=M,g=B,_=I,p=G;return a(),c(w,null,[i(_,{visible:n.visible,"onUpdate:visible":[l[0]||(l[0]=f=>n.visible=f),l[1]||(l[1]=()=>{x("close")})],maximizable:!0,modal:"",header:"Header",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{header:k(()=>[pe]),footer:k(()=>[i(g,{label:"Supprimer le produit",onClick:d,icon:"pi pi-times",class:"p-button-danger p-2 p-button-s",loading:t(m)},null,8,["loading"])]),default:k(()=>[e("div",ue,[e("div",_e,[me,(a(!0),c(w,null,C(t(s).ims_prod,f=>(a(),c("div",{class:"flex flex-wrap mr-2",key:f.im_id},[i(o,{src:`/api/p/media/${f.im_ref}`,alt:"Image",width:"100",preview:""},null,8,["src"])]))),128))]),e("div",fe,[ve,e("div",he,[(a(!0),c(w,null,C(t(s).cat_in,(f,y)=>(a(),c("div",{onClick:()=>{let V=Object.assign(t(s).cat_in[y]);t(s).cat_out.push(V),t(s).cat_in.splice(y,1)},class:"cursor-pointer mr-2 rounded bg-green-500 text-white p-1",key:f.cat_id},[e("span",xe,j(f.cat_label),1)],8,be))),128))]),ge,e("div",$e,[(a(!0),c(w,null,C(t(s).cat_out,(f,y)=>(a(),c("div",{onClick:()=>{let V=Object.assign(t(s).cat_out[y]);t(s).cat_in.push(V),t(s).cat_out.splice(y,1)},class:"cursor-pointer mr-2 rounded p-1 border bg-gray-50",key:f.cat_id},[e("span",we,j(f.cat_label),1)],8,ye))),128))]),e("div",ke,[i(g,{icon:"pi pi-check",class:"p-button-sm p-2",loading:t(m),label:"Enregistrer",onClick:b},null,8,["loading"])])])])]),_:1},8,["visible"]),i(p)],64)}}},Ce={class:"flex p-2 items-center text-gray-700"},je=e("div",{class:"flex"},[e("span",{class:"font-bold underline text-lg"}," Liste des produits ")],-1),Pe=e("span",{class:"flex-grow"},null,-1),De={key:0,class:""},Se={class:"flex p-2 border-b"},Be={class:"w-[100px] h-[60px]"},Ie={class:"flex flex-col px-2"},Le={class:"flex p-2 border-b"},Te={class:"w-[100px] h-[60px]"},Ee={class:"flex flex-col px-2"},Ne={key:1,class:""},Ue={class:"w-[100px] h-[60px] overflow-hidden rounded border flex items-center justify-center"},Ae=["src"],ze={class:"flex text-gray-700 flex-col w-1/3 px-2"},Fe=["onClick"],He={class:"text-sm"},Oe={class:"flex flex-col p-2"},qe={class:"mb-1"},Me={class:""},Ge={key:2,class:"w-full flex justify-center items-center"},Je=e("span",{class:"p-5"}," Auncun produit pour le moment ",-1),Ke=[Je],hs={__name:"products",setup(P){const $=v(!1),n=v(!1),x=v([]),m=v(null),s=v(!1);async function h(){s.value=!0;try{const b=await $fetch("/api/a/products");b.status?x.value=b.products:console.log(b.message)}catch(b){console.log(b)}s.value=!1}return q(()=>{h()}),(b,d)=>{const r=B,l=E,o=N,g=ce,_=Ve;return a(),c(w,null,[e("div",Ce,[je,Pe,i(r,{label:"Ajouter",onClick:d[0]||(d[0]=()=>{$.value=!0}),icon:"pi pi-plus",class:"p-button-sm p-2"})]),t(s)?(a(),c("div",De,[e("div",Se,[e("div",Be,[i(l,{width:"100%",height:"100%"})]),e("div",Ie,[i(l,{width:"9rem",class:"mb-2"}),i(l,{width:"5rem",class:"mb-2"})])]),e("div",Le,[e("div",Te,[i(l,{width:"100%",height:"100%"})]),e("div",Ee,[i(l,{width:"9rem",class:"mb-2"}),i(l,{width:"5rem",class:"mb-2"})])])])):(a(),c("div",Ne,[(a(!0),c(w,null,C(t(x),p=>(a(),c("div",{class:"flex p-2 border-b hover:bg-gray-50",key:p.prod_id},[e("div",Ue,[e("img",{src:`/api/p/media/${p.im_ref}`,class:"object-cover rounded",alt:""},null,8,Ae)]),e("div",ze,[e("span",{class:"font-bold underline cursor-pointer",onClick:()=>{m.value=p.prod_id,n.value=!0}},j(p.prod_label),9,Fe),e("span",He," Prix : "+j(parseInt(p.prod_price).toLocaleString("fr-CA")),1)]),e("div",Oe,[e("span",qe,[T(" Etat : "),p.prod_publish?(a(),S(o,{key:0,value:"Public",severity:"success"})):D("",!0),p.prod_publish?D("",!0):(a(),S(o,{key:1,value:"Brouillon",severity:"warning"}))]),e("span",Me," Stock : "+j(p.prod_stock||0),1)])]))),128))])),!t(s)&&t(x).length==0?(a(),c("div",Ge,Ke)):D("",!0),i(g,{visible:t($),onClose:d[1]||(d[1]=p=>$.value=!1),onValidate:d[2]||(d[2]=()=>{h(),$.value=!1})},null,8,["visible"]),i(_,{visible:t(n),prod_id:t(m),onClose:d[3]||(d[3]=p=>n.value=!1),onValidate:d[4]||(d[4]=()=>{h(),n.value=!1})},null,8,["visible","prod_id"])],64)}}};export{hs as default};
